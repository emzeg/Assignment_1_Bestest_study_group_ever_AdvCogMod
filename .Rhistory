ResultMemory[index] <- feedback
if (i %% 5 == 0 && sum(ResultMemory, na.rm = TRUE) < 3) {
if (WSLS_strategy == TRUE) {
WSLS_strategy = FALSE
} else {
WSLS_strategy = TRUE
}
}
if (WSLS_strategy == TRUE) {
StratSwitcherChoice[i] <- WSLSAgent_f(StratSwitcherChoice[i - 1], feedback)
} else {
StratSwitcherChoice[i] <- RandomAgent_f(rate)
}
}
return(StratSwitcherChoice)
}
#chance to switch even when winning = 0.1, change to stay even when losing = 0.3
WSLSAgent_modified_prob_f <- function(rate = 0.5, Other_Player, switchProbLose = 0.3, switchProbWin = 0.1, trials = 120) {
WSLSAgent_modified_choice <- rep(NA, trials)
WSLSAgent_modified_choice[1] <- RandomAgent_f(rate)
for (i in 2:trials) {
# P2 (WSLS modified) wins on match, always, since p2!
if (Other_Player[i - 1] == WSLSAgent_modified_choice[i - 1]) {
feedback <- 1
} else {
feedback <- 0
}
if (feedback == 1) {
if (runif(1) < switchProbWin) {
WSLSAgent_modified_choice[i] <- 1 - WSLSAgent_modified_choice[i - 1]
} else {
WSLSAgent_modified_choice[i] <- WSLSAgent_modified_choice[i - 1]
}
} else {
if (runif(1) > switchProbLose) {
WSLSAgent_modified_choice[i] <- 1 - WSLSAgent_modified_choice[i - 1]
} else {
WSLSAgent_modified_choice[i] <- WSLSAgent_modified_choice[i - 1]
}
}
}
return(WSLSAgent_modified_choice)
}
# single-step versions of reactive agents (needed when both are reactive -> they have to play eachother trial-by-trial)
StratSwitcherChoice_f_single <- function(prevChoice, feedback, ResultMemory, WSLS_strategy, i) {
index <- ((i - 1) %% 5) + 1
ResultMemory[index] <- feedback
if (i %% 5 == 0 && sum(ResultMemory, na.rm = TRUE) < 3) {
if (WSLS_strategy == TRUE) {
WSLS_strategy = FALSE
} else {
WSLS_strategy = TRUE
}
}
if (WSLS_strategy == TRUE) {
choice <- WSLSAgent_f(prevChoice, feedback)
} else {
choice <- RandomAgent_f(rate)
}
return(list(choice = choice, ResultMemory = ResultMemory, WSLS_strategy = WSLS_strategy))
}
WSLSModified_f_single <- function(prevChoice, feedback, switchProbLose = 0.3, switchProbWin = 0.1) {
if (feedback == 1) {
if (runif(1) < switchProbWin) {
choice <- 1 - prevChoice
} else {
choice <- prevChoice
}
} else {
if (runif(1) > switchProbLose) {
choice <- 1 - prevChoice
} else {
choice <- prevChoice
}
}
return(choice)
}
#overall results df
results <- tibble(
matchup = character(),
run = integer(),
trial = integer(),
p1_win = numeric(),
p2_win = numeric()
)
#function to store per-trial win result for p2 to df
run_and_store <- function(p1_choices, p2_choices, matchup_name, r) {
tibble(
matchup = matchup_name,
run = r,
trial = 1:trials,
p1_win = as.numeric(p1_choices != p2_choices), # P1 wins if P2 guesses wrong
p2_win = as.numeric(p1_choices == p2_choices)  # P2 wins if guess is correct
)
}
#run all the simulations
for (r in 1:n_runs) {
# Random vs WSLS (random goes first, then WSLS reacts)
rnd <- sapply(1:trials, function(x) RandomAgent_f(rate))
wsls <- c(RandomAgent_f(rate), rep(NA, trials - 1))
for (i in 2:trials) {
# WSLS is P2 (matcher)
feedback_wsls <- as.numeric(wsls[i-1] == rnd[i-1])
wsls[i] <- WSLSAgent_f(wsls[i-1], feedback_wsls)
}
results <- bind_rows(results, run_and_store(rnd, wsls, "Random vs WSLS", r))
# Random vs StratSwitcher (random goes first, then StratSwitcher reacts)
rnd <- sapply(1:trials, function(x) RandomAgent_f(rate))
ss <- StratSwitcherChoice_f(rnd, rate)
results <- bind_rows(results, run_and_store(rnd, ss, "Random vs StratSwitcher", r))
# WSLS vs StratSwitcher (both reactive, play turn by turn)
wsls <- rep(NA, trials)
ss <- rep(NA, trials)
wsls[1] <- RandomAgent_f(rate) #first choice random for both
ss[1] <- RandomAgent_f(rate)
ss_memory <- rep(NA, 5)
ss_strategy <- TRUE
for (i in 2:trials) {
feedback_wsls <- as.numeric(wsls[i-1] != ss[i-1]) # WSLS is P1 (mismatcher) (flipped feedback)
feedback_ss   <- as.numeric(ss[i-1] == wsls[i-1]) # StratSwitcher is P2 (matcher)
wsls[i] <- WSLSAgent_f(wsls[i-1], feedback_wsls)
ss_step <- StratSwitcherChoice_f_single(ss[i-1], feedback_ss, ss_memory, ss_strategy, i)
ss[i] <- ss_step$choice
ss_memory <- ss_step$ResultMemory
ss_strategy <- ss_step$WSLS_strategy
}
results <- bind_rows(results, run_and_store(wsls, ss, "WSLS vs StratSwitcher", r))
# Random vs WSLS Modified (random goes first, then WSLS modified reacts)
rnd <- sapply(1:trials, function(x) RandomAgent_f(rate))
wsls_mod <- WSLSAgent_modified_prob_f(rate = rate, Other_Player = rnd)
results <- bind_rows(results, run_and_store(rnd, wsls_mod, "Random vs WSLS Modified", r))
# WSLS vs WSLS Modified (both reactive, they play trial by trial)
wsls <- rep(NA, trials)
wsls_mod <- rep(NA, trials)
wsls[1] <- RandomAgent_f(rate) #first choice random for both
wsls_mod[1] <- RandomAgent_f(rate)
for (i in 2:trials) {
feedback_wsls <- as.numeric(wsls[i-1] != wsls_mod[i-1]) # WSLS is P1 mismatcher (flipped feedback)
feedback_wsls_mod  <- as.numeric(wsls_mod[i-1] == wsls[i-1]) # WSLS_mod is P2 matcher
wsls[i]     <- WSLSAgent_f(wsls[i-1], feedback_wsls) #goes first (wsls)
wsls_mod[i] <- WSLSModified_f_single(wsls_mod[i-1], feedback_wsls_mod) #wsls_mod reacts
}
results <- bind_rows(results, run_and_store(wsls, wsls_mod, "WSLS vs WSLS Modified", r))
}
#average win rate per trial across runs, then cumulate
results_mean <- results %>%
group_by(matchup, trial) %>%
summarise(
mean_p1_win = mean(p1_win),
mean_p2_win = mean(p2_win),
.groups = "drop"
) %>%
group_by(matchup) %>%
mutate(
mean_p1_cumwinrate = cumsum(mean_p1_win) / trial,
mean_p2_cumwinrate = cumsum(mean_p2_win) / trial
) %>%
ungroup()
#plot cumulative win rate over trials for both players
results_long <- results_mean %>%
pivot_longer(
cols = c(mean_p1_cumwinrate, mean_p2_cumwinrate),
names_to = "player",
values_to = "cumwinrate"
)
ggplot(results_long, aes(x = trial, y = cumwinrate, color = player)) +
geom_line(linewidth = 1) +
geom_hline(yintercept = 0.5, linetype = "dashed", color = "red") +
facet_wrap(~matchup) +
theme_tufte() +
labs(
title = "P1 and P2 Cumulative Win Rate over 100 Runs",
x = "Trial",
y = "Cumulative Win Rate",
color = "Player"
) +
scale_color_manual(
values = c("mean_p1_cumwinrate" = "red", "mean_p2_cumwinrate" = "blue"),
labels = c("mean_p1_cumwinrate" = "Cumulative Winrate P1",
"mean_p2_cumwinrate" = "Cumulative Winrate P2")
)
#overall average win rate per matchup
results_mean %>%
filter(trial == trials) %>%
select(matchup, mean_p1_cumwinrate, mean_p2_cumwinrate) %>%
mutate(
`P1 WINRATE (cumulative)` = paste0(round(mean_p1_cumwinrate * 100, 1), "%"),
`P2 WINRATE (cumulative)` = paste0(round(mean_p2_cumwinrate * 100, 1), "%")
) %>%
select(matchup, `P1 WINRATE (cumulative)`, `P2 WINRATE (cumulative)`) %>%
print()
##no strat dominates, not even WSLS against anything? (outside of WSLS modified sucking)
#install.packages("pacman")
pacman::p_load(tidyverse, ggplot2, tibble, paletteer, ggthemes)
set.seed(1234)
#the two default players
#entirely random
RandomAgent_f <- function(rate){
choice <- rbinom(1,1,rate)
return (choice)
}
#WSLS (unchanged)
WSLSAgent_f <- function(prevChoice, feedback){
if (feedback == 1){
choice = prevChoice
} else if (feedback ==0){
choice = (1 - prevChoice)
}
return(choice)
}
#plotting & df functions
#(simple, just dont want to repeat the code over and over, still need better plots)
df_f <- function(player1, player2, trials) {
df <- tibble(
player1,
player2,
trials = seq(trials),
feedback = as.numeric(player1 == player2)
)
return (df)
}
plot_f <- function(df, player1, player2, trials) {
plot <- ggplot(df) +
theme_classic() +
geom_line(color = "red", aes(trials, player1)) + #red is P1
geom_line(color = "blue", aes(trials, player2))  # blue is P2
return (plot)
}
#plot winrate (simple)
plot_winrate_f <- function(df) {
df <- df %>%
mutate(cumulative_rateSelf= cumsum(feedback) / seq_along(feedback),
cumulative_rateOther= cumsum(1-feedback) / seq_along(feedback) )
winrate_plot <- ggplot(df) + theme_classic() + geom_line(color="red", aes(trials, cumulative_rateSelf)) + geom_line(color="blue", aes(trials, cumulative_rateOther))
return (winrate_plot)
}
#somewhat better plot for winrate
winning_n_plot <- function(df, player1_name, player2_name,
p1_color = "#7df3e1", p2_color = "lightgreen") {
p1_wins <- sum(df$feedback)
p2_wins <- nrow(df) - p1_wins
plot <- ggplot(df) +
geom_bar(aes(x = trials, y = feedback, fill = player1_name), stat = "identity") +
geom_bar(aes(x = trials, y = -(1 - feedback), fill = player2_name), stat = "identity") +
theme_tufte() +
labs(x = "Trials", y = "Winner", fill = "",
title = paste(player1_name, "vs", player2_name)) +
scale_fill_manual(
values = setNames(c(p1_color, p2_color), c(player1_name, player2_name)),
breaks = c(player1_name, player2_name),
labels = c(paste0(player1_name, " (", p1_wins, " wins)"),
paste0(player2_name, " (", p2_wins, " wins)"))
) +
scale_y_continuous(limits = c(-1, 1), breaks = c(-1, 0, 1),
labels = c(player2_name, "0", player1_name))  # p2 is negative, p1 is positive
return(plot)
}
#some setup
trials <- 120
n_participants <- 100 #unused but needed for the report(?)
randomChoice <- (rep(NA,trials))
rate <- 0.5
#random (generate answers)
for (t in seq(trials)){
randomChoice[t] <- RandomAgent_f(rate)
}
d1 <- tibble(trial = seq(trials), choice = randomChoice)
p1 <- ggplot(d1, aes(trial,choice)) + geom_line() + theme_classic()
#WSLS playing against Random
WSLSChoice <- rep(NA, trials)
WSLSChoice[1] <- RandomAgent_f(rate) #picks random on first trial
for (i in 2:trials){
if (randomChoice[i-1] == WSLSChoice[i-1]){
feedback = 1
} else {feedback = 0}
WSLSChoice[i] <- WSLSAgent_f(WSLSChoice[i-1], feedback)
}
#should make this into a function
df <- tibble(
randomChoice,
WSLSChoice,
trials = seq(trials),
feedback = as.numeric(randomChoice == WSLSChoice))
df <- df_f(randomChoice, WSLSChoice, trials)
plot_f(df, randomChoice, WSLSChoice, trials )
#winrate plot of Random vs WSLS (WSLS is blue)
winrate_plot <- plot_winrate_f(df)
winrate_plot
winning_n_plot(df, "Random", "WSLS")
StratSwitcherChoice_f <- function(Other_Player, rate) {
StratSwitcherChoice <- rep(NA, trials)
StratSwitcherChoice[1] <- RandomAgent_f(rate) #picks random on first trial
ResultMemory <- rep(NA, 5)
WSLS_strategy <- TRUE
feedback = NA
StratSwitcherChoice[1] <- RandomAgent_f(rate)
for (i in 2:trials) {
#Starts off with checking feedback
if (Other_Player[i - 1] == StratSwitcherChoice[i - 1]) {
feedback = 1
} else {
feedback = 0
}
#add feedback to memory (5 tiles long)
index <- ((i - 1) %% 5) + 1 #so its max 5
ResultMemory[index] <- feedback
#switches choices every 5 trials if the last 5 trials have been bad
if (i %% 5 == 0 && sum(ResultMemory, na.rm = TRUE) < 3) {
#cat("Ahhh, I hate failure... switching; WSLS_strategy: ",WSLS_strategy,"trial number:" ,i, "win amount in last 5:", sum(ResultMemory, na.rm = TRUE), "\n")
if (WSLS_strategy == TRUE) {
WSLS_strategy = FALSE
} else {
WSLS_strategy = TRUE
}
}
#either plays WSLS or Random otherwise
if (WSLS_strategy == TRUE) {
StratSwitcherChoice[i] <- WSLSAgent_f(StratSwitcherChoice[i - 1], feedback)
} else {
StratSwitcherChoice[i] <- RandomAgent_f(rate)
}
}
return (StratSwitcherChoice)
}
#play against both Random and WSLS
StratSwitcherChoice_against_Random <- StratSwitcherChoice_f(Other_Player = randomChoice, rate = 0.5)
StratSwitcherChoice_against_WSLS <- StratSwitcherChoice_f(Other_Player = WSLSChoice, rate = 0.5)
#against RANDOM (BLUE is the StratSwitcher)
df1 <- df_f(randomChoice, StratSwitcherChoice_against_Random, trials)
plot_f(df1, randomChoice, StratSwitcherChoice_against_Random, trials )
#winning n plot
winning_n_plot(df1, "Random", "Strategy Switcher", p2_color = "#FFC067")
#plotting the win-rate
winrate_plot1 <- plot_winrate_f(df1)
winrate_plot1
#against WSLS (BLUE is the StratSwitcher)
df2 <- df_f(WSLSChoice, StratSwitcherChoice_against_WSLS, trials)
plot_f(df2, WSLSChoice, StratSwitcherChoice_against_WSLS, trials )
#winning n plot
winning_n_plot(df2, "WSLS", "Strategy Switcher", p1_color = "lightgreen", p2_color = "#FFC067")
#plotting the win-rate
winrate_plot2 <- plot_winrate_f(df2)
winrate_plot2
#10% chance to SWITCH after winning; 30% chance to STAY after losing
#SHOULD these be different? (brain fried)
WSLSAgent_modified_prob_f <- function(rate = 0.5, Other_Player, switchProbLose = 0.3, switchProbWin = 0.1, trials = 120) {
WSLSAgent_modified_choice <- rep(NA, trials)
WSLSAgent_modified_choice[1] <- RandomAgent_f(rate) # picks random on first trial
for (i in 2:trials) {
#feedback based on the last trial
if (Other_Player[i - 1] == WSLSAgent_modified_choice[i - 1]) {
feedback <- 1
} else {
feedback <- 0
}
#might switch, even if shouldnt (10% chance)
if (feedback == 1) {
if (runif(1) < switchProbWin) {
WSLSAgent_modified_choice[i] <- 1 - WSLSAgent_modified_choice[i - 1]
#cat("won but still switching! ", WSLSAgent_modified_choice[i-1], " last choice; ", WSLSAgent_modified_choice[i], "this choice" , "\n")
} else {
WSLSAgent_modified_choice[i] <- WSLSAgent_modified_choice[i - 1]
}
}
#might switch, even if shouldnt (30% chance)
else {
if (runif(1) > switchProbLose) {
WSLSAgent_modified_choice[i] <- 1 - WSLSAgent_modified_choice[i - 1]
} else {
WSLSAgent_modified_choice[i] <- WSLSAgent_modified_choice[i - 1]
#cat("lost but still staying! ", WSLSAgent_modified_choice[i-1], " last choice; ", WSLSAgent_modified_choice[i], "this choice" , "\n")
}
}
}
return(WSLSAgent_modified_choice)
}
WSLS_modified_against_Random <- WSLSAgent_modified_prob_f(rate = 0.5, Other_Player = randomChoice, switchProbLose = 0.3, switchProbWin = 0.1)
WSLS_modified_against_WSLS <- WSLSAgent_modified_prob_f(rate = 0.5, Other_Player = WSLSChoice, switchProbLose = 0.3, switchProbWin = 0.1)
#against RANDOM (BLUE is the WSLS modified)
df1_2 <- df_f(randomChoice, WSLS_modified_against_Random, trials)
plot_f(df1_2, randomChoice, WSLS_modified_against_Random, trials)
#winning n plot
winning_n_plot(df1_2, "Random", "WSLS Modified", p2_color = "#ffdf00")
#plotting the win-rate
winrate_plot1_2 <- plot_winrate_f(df1_2)
winrate_plot1_2
#against WSLS (BLUE is the WSLS MODIFIED)
df2_2 <- df_f(WSLSChoice, WSLS_modified_against_WSLS, trials)
plot_f(df2_2, WSLSChoice, WSLS_modified_against_WSLS, trials )
#winning n plot
winning_n_plot(df2_2, "WSLS", "WSLS Modified", p1_color = "lightgreen",p2_color = "#ffdf00")
#plotting the win-rate
winrate_plot2_2 <- plot_winrate_f(df2_2)
winrate_plot2_2
results_mean
View(results_mean)
final_winrates <- results %>%
group_by(matchup, run) %>%
summarise(
p1_cumwin = sum(p1_win) / trials,
p2_cumwin = sum(p2_win) / trials
) %>%
group_by(matchup) %>%
summarise(
mean_p1_cumwin = mean(p1_cumwin),
mean_p2_cumwin = mean(p2_cumwin)
)
final_winrates
results_mean %>%
filter(trial == trials) %>%
select(matchup, mean_p1_cumwinrate, mean_p2_cumwinrate) %>%
mutate(
`P1 WINRATE (cumulative)` = paste0(round(mean_p1_cumwinrate * 100, 1), "%"),
`P2 WINRATE (cumulative)` = paste0(round(mean_p2_cumwinrate * 100, 1), "%")
) %>%
select(matchup, `P1 WINRATE (cumulative)`, `P2 WINRATE (cumulative)`) %>%
print()
#average win rate per trial across runs, then cumulate
results_mean <- results %>%
group_by(matchup, trial) %>%
summarise(
mean_p1_win = mean(p1_win),
mean_p2_win = mean(p2_win),
.groups = "drop"
) %>%
group_by(matchup) %>%
mutate(
mean_p1_cumwinrate = cumsum(mean_p1_win) / trial,
mean_p2_cumwinrate = cumsum(mean_p2_win) / trial
) %>%
ungroup()
#plot cumulative win rate over trials for both players
results_long <- results_mean %>%
pivot_longer(
cols = c(mean_p1_cumwinrate, mean_p2_cumwinrate),
names_to = "player",
values_to = "cumwinrate"
)
ggplot(results_long, aes(x = trial, y = cumwinrate, color = player)) +
geom_line(linewidth = 1) +
geom_hline(yintercept = 0.5, linetype = "dashed", color = "red") +
facet_wrap(~matchup) +
theme_tufte() +
labs(
title = "P1 and P2 Cumulative Win Rate over 100 Runs",
x = "Trial",
y = "Cumulative Win Rate",
color = "Player"
) +
scale_color_manual(
values = c("mean_p1_cumwinrate" = "red", "mean_p2_cumwinrate" = "blue"),
labels = c("mean_p1_cumwinrate" = "Cumulative Winrate P1",
"mean_p2_cumwinrate" = "Cumulative Winrate P2")
)
#overall average win rate per matchup
results_mean %>%
filter(trial == trials) %>%
select(matchup, mean_p1_cumwinrate, mean_p2_cumwinrate) %>%
mutate(
`P1 WINRATE (cumulative)` = paste0(round(mean_p1_cumwinrate * 100, 1), "%"),
`P2 WINRATE (cumulative)` = paste0(round(mean_p2_cumwinrate * 100, 1), "%")
) %>%
select(matchup, `P1 WINRATE (cumulative)`, `P2 WINRATE (cumulative)`) %>%
print()
##no strat dominates, not even WSLS against anything? (outside of WSLS modified sucking)
ggplot(results_long, aes(x = trial, y = cumwinrate, color = player)) +
geom_line(linewidth = 1) +
geom_hline(yintercept = 0.5, linetype = "dashed", color = "black") +
facet_wrap(~matchup) +
theme_tufte() +
labs(
title = "P1 and P2 Cumulative Win Rate over 100 Runs",
x = "Trial",
y = "Cumulative Win Rate",
color = "Player"
) +
scale_color_manual(
values = c("mean_p1_cumwinrate" = "red", "mean_p2_cumwinrate" = "blue"),
labels = c("mean_p1_cumwinrate" = "Cumulative Winrate P1",
"mean_p2_cumwinrate" = "Cumulative Winrate P2")
)
ggplot(results_long, aes(x = trial, y = cumwinrate, color = player)) +
geom_line(linewidth = 1) +
geom_hline(yintercept = 0.5, linetype = "dashed", color = "black") +
facet_wrap(~matchup) +
labs(
title = "P1 and P2 Cumulative Win Rate over 100 Runs",
x = "Trial",
y = "Cumulative Win Rate",
color = "Player"
) +
scale_color_manual(
values = c("mean_p1_cumwinrate" = "red", "mean_p2_cumwinrate" = "blue"),
labels = c("mean_p1_cumwinrate" = "Cumulative Winrate P1",
"mean_p2_cumwinrate" = "Cumulative Winrate P2")
)
ggplot(results_long, aes(x = trial, y = cumwinrate, color = player)) +
geom_line(linewidth = 1) +
geom_hline(yintercept = 0.5, linetype = "dashed", color = "black") +
facet_wrap(~matchup) +
theme_bw()+
labs(
title = "P1 and P2 Cumulative Win Rate over 100 Runs",
x = "Trial",
y = "Cumulative Win Rate",
color = "Player"
) +
scale_color_manual(
values = c("mean_p1_cumwinrate" = "red", "mean_p2_cumwinrate" = "blue"),
labels = c("mean_p1_cumwinrate" = "Cumulative Winrate P1",
"mean_p2_cumwinrate" = "Cumulative Winrate P2")
)
